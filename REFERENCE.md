# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Classes**

* [`simp_grafana`](#simp_grafana): This module acts as a SIMP wrapper ("profile") for the Puppet, Inc. Approved Grafana module written by Bill Fraser and maintained by Vox Pupu
* [`simp_grafana::config::firewall`](#simp_grafanaconfigfirewall): Class simp_grafana::config::firewall  This class is meant to be called from simp_grafana. It ensures that firewall rules are defined.
* [`simp_grafana::config::pki`](#simp_grafanaconfigpki): Class: simp_grafana::config::config::pki  This class is meant to be called from simp_grafana. It ensures that pki rules are defined.

## Classes

### simp_grafana

This module acts as a SIMP wrapper ("profile") for the Puppet, Inc. Approved
Grafana module written by Bill Fraser and maintained by Vox Pupuli.  It sets
baseline of secure defaults and integrates Grafana with other SIMP components.

> NOTE: If SIMP integration is not required, direct use of the component Grafana
  module is advised.

> NOTE: If providing LDAP configuration via $ldap_cfg, SIMP's smart defaults
  will not be used. The defaults will also not be used if $ldap or
  `simp_options::ldap` is false. Make sure all needed options are set if
  specifying a custom $ldap_cfg.

> NOTE: SIMP LDAP smart defaults
  SIMP LDAP smart defaults will automatically be used unless one of the following are met:
    * $ldap_cfg is set and not empty
    * $ldap == true OR $cfg['auth.ldap'] == {'enabled' => true}

  Smart defaults are provided by the following parameters:
    * $bind_dn
    * $bind_pw
    * $base_dn
    * $simp_ldap_server_namehost

  If you are using a custom LDAP server, you MUST provide these settings in the $ldap_cfg hash,
  along with the 'verbose_logging' setting, as there is no merge between your custom settings
  and smart defaults. An example of the $ldap_cfg param and it's required settings can be seen in
  the Resource-style class declaration example at the end of the comments.

# Welcome to SIMP!

This module is a component of the System Integrity Management Platform (SIMP),
a managed security compliance framework built on Puppet.

This module is optimally designed for use within a larger SIMP ecosystem, but
it can be used independently:

* As a SIMP wrapper module, the defaults use the larger SIMP ecosystem to
  manage security compliance settings from the Puppet server.

* If used independently, all SIMP-managed security subsystems may be disabled
  via the `firewall` and `pki` settings.

#### Examples

##### Resource-style class declaration

```puppet
class { 'simp_grafana':
  firewall        => true,
  pki             => true,
  trusted_nets    => ['10.255.0.0/16'],
  cfg             => { 'auth.ldap' => { enabled => true } },
  ldap_cfg        => {
    verbose_logging => true,
    servers         => [
      {
        host                  => 'ldap.example.com',
        port                  => 636,
        use_ssl               => true,
        bind_dn               => 'uid=grafana,ou=Services,dc=test',
        bind_password         => '123$%^qweRTY',
        search_filter         => '(uid=%s)',
        search_base_dns       => ['ou=People,dc=test'],
        group_search_filter   => '(&(objectClass=posixGroup)(memberUid=%s))',
        group_search_base_dns => ['ou=Group,dc=test'],
        attributes            => {
          name      => 'givenName',
          surname   => 'sn',
          username  => 'uid',
          member_of => 'gidNumber',
          email     => 'mail',
        },
        group_mappings => [
          { group_dn => 'admin', org_role => 'Admin'  },
          { group_dn => '50001', org_role => 'Editor' },
        ],
      },
    ],
  },
}
```

#### Parameters

The following parameters are available in the `simp_grafana` class.

##### `trusted_nets`

Data type: `Simplib::Netlist`

A whitelist of subnets
(in CIDR notation) permitted access.

Default value: simplib::lookup('simp_options::trusted_nets', { 'default_value' => ['127.0.0.1/8'] })

##### `firewall`

Data type: `Boolean`

If true, manage firewall rules to
accommodate simp_grafana.

Default value: simplib::lookup('simp_options::firewall', { 'default_value' => false })

##### `ldap`

Data type: `Boolean`

If true, enable ldap authentication using $ldap_cfg
The following settings are set in puppet and are parameters of this class:
* $ldap_urls
* $base_dn
* $bind_dn
* $bind_pw

Default value: simplib::lookup('simp_options::ldap', { 'default_value' => false })

##### `ldap_urls`

Data type: `Array[Simplib::URI,1]`

LDAP server urls

Default value: simplib::lookup('simp_options::ldap::uri', { 'default_value' => undef } )

##### `base_dn`

Data type: `String`

Base DN of the LDAP server

Default value: simplib::lookup('simp_options::ldap::base_dn', { 'default_value' => simplib::ldap::domain_to_dn() } )

##### `bind_dn`

Data type: `String`

Bind DN of the LDAP server

Default value: simplib::lookup('simp_options::ldap::bind_dn', { 'default_value' => "uid=%s,${base_dn}" } )

##### `bind_pw`

Data type: `String`

Bind passworf for the bind_dn

Default value: simplib::lookup('simp_options::ldap::bind_pw', { 'default_value' => undef } )

##### `pki`

Data type: `Variant[Boolean,Enum['simp']]`

* If 'simp', include SIMP's pki module and use pki::copy to manage
  application certs in /etc/pki/simp_apps/grafana/x509
* If true, do *not* include SIMP's pki module, but still use pki::copy
  to manage certs in /etc/pki/simp_apps/grafana/x509
* If false, do not include SIMP's pki module and do not use pki::copy
  to manage certs.  You will need to appropriately assign a subset of:
  * app_pki_dir
  * app_pki_key
  * app_pki_cert
  * app_pki_ca
  * app_pki_ca_dir

Default value: simplib::lookup('simp_options::pki', { 'default_value' => false })

##### `app_pki_external_source`

Data type: `String`

* If pki = 'simp' or true, this is the directory from which certs will be
  copied, via pki::copy.  Defaults to /etc/pki/simp/x509.

* If pki = false, this variable has no effect.

Default value: simplib::lookup('simp_options::pki::source', { 'default_value' => '/etc/pki/simp/x509' })

##### `app_pki_dir`

Data type: `String`

This variable controls the basepath of $app_pki_key, $app_pki_cert,
$app_pki_ca, $app_pki_ca_dir, and $app_pki_crl.

##### `app_pki_key`

Data type: `String`

Path and name of the private SSL key file

Default value: "${app_pki_dir}/private/${facts['fqdn']}.pem"

##### `app_pki_cert`

Data type: `String`

Path and name of the public SSL certificate

Default value: "${app_pki_dir}/public/${facts['fqdn']}.pub"

##### `default_cfg`

Data type: `Hash`

Default values for grafana

##### `cfg`

Data type: `Hash`

A passthrough to the Grafana component module, this will be
merged with the SIMP defaults in `default_cfg`.

##### `ldap_cfg`

Data type: `Hash`

Grafana ldap configuration. If this is set, make sure to
set all the params needed. There will be no merging.

@see http://docs.grafana.org/installation/ldap/

##### `simp_ldap_conf`

Data type: `Hash`

Defaults for the SIMP LDAP server, using data in
modules. These settings can be checked by running
`puppet lookup simp_grafana::simp_ldap_conf`.

##### `ldap_verbose_logging`

Data type: `Boolean`

Enables verbose logging for the LDAP connections

##### `admin_pw`

Data type: `String`

Grafana's default admin password

Default value: simplib::passgen('simp_grafana')

##### `install_method`

Data type: `String`

A passthrough to the Grafana module, this sets
the installation method of Grafana to a repository by default since this is
the SIMP preferred method for installing packages.

##### `use_internet_repo`

Data type: `Boolean`

If set, allow the `grafana` module to point
to the appropriate package repository on the Internet automatically.

##### `version`

Data type: `String`

Version of grafana to install

Default value: simplib::lookup('simp_options::package_ensure', { 'default_value' => 'installed' })

##### `rpm_iteration`

Data type: `String`

Passed directly to the `grafana` class

##### `simp_dashboards`

Data type: `Boolean`

Install SIMP dashboards

### simp_grafana::config::firewall

Class simp_grafana::config::firewall

This class is meant to be called from simp_grafana.
It ensures that firewall rules are defined.

### simp_grafana::config::pki

Class: simp_grafana::config::config::pki

This class is meant to be called from simp_grafana.
It ensures that pki rules are defined.

